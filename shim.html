<!DOCTYPE html>
<!-- saved from url=(0132)blob:https://2lile8s60nh4f47jkf5h2r1i2bycfk2xdicg8ycr2z3a5best7-h802130808.scf.usercontent.goog/c06ba3ed-f1bb-473c-9557-cbd1878acedf -->
<html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><script>(function(firebaseConfig, initialAuthToken, appId) {
        window.__firebase_config = firebaseConfig;
        window.__initial_auth_token = initialAuthToken;
        window.__app_id = appId;
            })("\n{\n  \"apiKey\": \"AIzaSyCqyCcs2R2e7AegGjvFAwG98wlamtbHvZY\",\n  \"authDomain\": \"bard-frontend.firebaseapp.com\",\n  \"projectId\": \"bard-frontend\",\n  \"storageBucket\": \"bard-frontend.firebasestorage.app\",\n  \"messagingSenderId\": \"175205271074\",\n  \"appId\": \"1:175205271074:web:2b7bd4d34d33bf38e6ec7b\"\n}\n","eyJhbGciOiJSUzI1NiIsImtpZCI6IjliMTEzMzgxNDVkZDk3ZmQ4YjgyMjgyYmRmNDg1ZDBiYjJiZmQwN2EiLCJ0eXAiOiJKV1QifQ.eyJzdWIiOiJmaXJlYmFzZS1hZG1pbnNkay1mYnN2Y0BiYXJkLWZyb250ZW5kLmlhbS5nc2VydmljZWFjY291bnQuY29tIiwiYXVkIjoiaHR0cHM6Ly9pZGVudGl0eXRvb2xraXQuZ29vZ2xlYXBpcy5jb20vZ29vZ2xlLmlkZW50aXR5LmlkZW50aXR5dG9vbGtpdC52MS5JZGVudGl0eVRvb2xraXQiLCJ1aWQiOiIwOTY5MTI4MzAyOTk0MDk4NTA2MSIsImlzcyI6ImZpcmViYXNlLWFkbWluc2RrLWZic3ZjQGJhcmQtZnJvbnRlbmQuaWFtLmdzZXJ2aWNlYWNjb3VudC5jb20iLCJjbGFpbXMiOnsiYXBwSWQiOiJjXzJjMGI5NTUyNThjZmZhYTZfaW5kZXguaHRtbC04ODUifSwiZXhwIjoxNzU3NTI1NTkxLCJpYXQiOjE3NTc1MjE5OTEsImFsZyI6IlJTMjU2In0.Gp7lAmJ1fDR8Hc-HNvAo2dbS0sLMnDl8zvhnopHxkCLXa7JR-5YXuFmzHRdVt-w1qz0jalNZ_bqDQnWyyjmT5gHwwMrIcp94u5wENESazTc4_lpFuA-43slVoV0yRZZ9XukvMgpO9Nxj7IaIqN_ee4EYVArouOmr5e1ZXHDteVhVnveFD5n4gWeMW1lOw6FQtcYKjH9EA7M5FV9gvbMIM1f2tfj_mV7VdCTJDHnD8B1ZpyGIJfd6hLzIhtcSnw053hZitOHBheJ2o-jyMAySmL13oJARnJa3vZmN0vQbLIGRZ7NcuQa-h-6xK-tS2Ry0mtFzzHVktGirA2qxofQfmQ","c_2c0b955258cffaa6_index.html-885")</script><script>'use strict';var h=typeof Object.defineProperties=="function"?Object.defineProperty:function(a,b,d){if(a==Array.prototype||a==Object.prototype)return a;a[b]=d.value;return a};function l(a){a=["object"==typeof globalThis&&globalThis,a,"object"==typeof window&&window,"object"==typeof self&&self,"object"==typeof global&&global];for(var b=0;b<a.length;++b){var d=a[b];if(d&&d.Math==Math)return d}throw Error("Cannot find global object");}var n=l(this);
function p(a,b){if(b)a:{var d=n;a=a.split(".");for(var c=0;c<a.length-1;c++){var e=a[c];if(!(e in d))break a;d=d[e]}a=a[a.length-1];c=d[a];b=b(c);b!=c&&b!=null&&h(d,a,{configurable:!0,writable:!0,value:b})}}function r(a){function b(c){return a.next(c)}function d(c){return a.throw(c)}return new Promise(function(c,e){function f(g){g.done?c(g.value):Promise.resolve(g.value).then(b,d).then(f,e)}f(a.next())})}function t(a){return r(a())}
p("Object.values",function(a){return a?a:function(b){var d=[],c;for(c in b)Object.prototype.hasOwnProperty.call(b,c)&&d.push(b[c]);return d}});p("Array.prototype.includes",function(a){return a?a:function(b,d){var c=this;c instanceof String&&(c=String(c));var e=c.length;d=d||0;for(d<0&&(d=Math.max(d+e,0));d<e;d++){var f=c[d];if(f===b||Object.is(f,b))return!0}return!1}});/*

 MIT License

 Copyright (c) 2017-2023 W.Y.

 Permission is hereby granted, free of charge, to any person obtaining a copy
 of this software and associated documentation files (the "Software"), to deal
 in the Software without restriction, including without limitation the rights
 to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 copies of the Software, and to permit persons to whom the Software is
 furnished to do so, subject to the following conditions:

 The above copyright notice and this permission notice shall be included in
 all copies or substantial portions of the Software.

 THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
 SOFTWARE.

*/
function u(a,b){const d=a.style;b.backgroundColor&&(d.backgroundColor=b.backgroundColor);b.width&&(d.width=`${b.width}px`);b.height&&(d.height=`${b.height}px`);const c=b.style;c!=null&&Object.keys(c).forEach(e=>{d[e]=c[e]})};var v=(()=>{let a=0;return()=>{a+=1;return`u${`0000${(Math.random()*1679616<<0).toString(36)}`.slice(-4)}${a}`}})();function w(a){const b=[];for(let d=0,c=a.length;d<c;d++)b.push(a[d]);return b}let x=null;function y(a={}){return x?x:a.l?x=a.l:x=w(window.getComputedStyle(document.documentElement))}function z(a,b){return(a=(a.ownerDocument.defaultView||window).getComputedStyle(a).getPropertyValue(b))?parseFloat(a.replace("px","")):0}
function A(a,b={}){var d;if(!(d=b.width)){d=z(a,"border-left-width");var c=z(a,"border-right-width");d=a.clientWidth+d+c}(b=b.height)||(b=z(a,"border-top-width"),c=z(a,"border-bottom-width"),b=a.clientHeight+b+c);return{width:d,height:b}}function B(a){return new Promise((b,d)=>{const c=new Image;c.onload=()=>{c.decode().then(()=>{requestAnimationFrame(()=>b(c))})};c.onerror=d;c.crossOrigin="anonymous";c.decoding="async";c.src=a})}
function C(a){return t(function*(){return Promise.resolve().then(()=>(new XMLSerializer).serializeToString(a)).then(encodeURIComponent).then(b=>`data:image/svg+xml;charset=utf-8,${b}`)})}
function D(a,b,d){return t(function*(){const c=document.createElementNS("http://www.w3.org/2000/svg","svg"),e=document.createElementNS("http://www.w3.org/2000/svg","foreignObject");c.setAttribute("width",`${b}`);c.setAttribute("height",`${d}`);c.setAttribute("viewBox",`0 0 ${b} ${d}`);e.setAttribute("width","100%");e.setAttribute("height","100%");e.setAttribute("x","0");e.setAttribute("y","0");e.setAttribute("externalResourcesRequired","true");c.appendChild(e);e.appendChild(a);return C(c)})}
var E=(a,b)=>{if(a instanceof b)return!0;a=Object.getPrototypeOf(a);return a===null?!1:a.constructor.name===b.name||E(a,b)};function F(a,b){return y(b).map(d=>{const c=a.getPropertyValue(d),e=a.getPropertyPriority(d);return`${d}: ${c}${e?" !important":""};`}).join(" ")}
function G(a,b,d,c){a=window.getComputedStyle(a,d);var e=a.getPropertyValue("content");if(e!==""&&e!=="none"){var f=v();try{b.className=`${b.className} ${f}`}catch(k){return}e=document.createElement("style");var g=e.appendChild;d=`.${f}:${d}`;a.cssText?(c=a.getPropertyValue("content"),c=`${a.cssText} content: '${c.replace(/'|"/g,"")}';`):c=F(a,c);g.call(e,document.createTextNode(`${d}{${c}}`));b.appendChild(e)}};function H(a){return a.search(/^(data:)/)!==-1}function I(a,b,d){return t(function*(){const c=yield fetch(a,b);if(c.status===404)throw Error(`Resource "${c.url}" not found`);const e=yield c.blob();return new Promise((f,g)=>{const k=new FileReader;k.onerror=g;k.onloadend=()=>{try{f(d({o:c,result:k.result}))}catch(m){g(m)}};k.readAsDataURL(e)})})}const J={};function K(a,b,d){let c=a.replace(/\?.*/,"");d&&(c=a);/ttf|otf|eot|woff2?/i.test(c)&&(c=c.replace(/.*\//,""));return b?`[${b}]${c}`:c}
function L(a,b,d){return t(function*(){const c=K(a,b,d.C);if(J[c]!=null)return J[c];d.u&&(a+=(/\?/.test(a)?"&":"?")+(new Date).getTime());let e;try{const f=yield I(a,d.i,({o:g,result:k})=>{b||(b=g.headers.get("Content-Type")||"");return k.split(/,/)[1]});e=`data:${b};base64,${f}`}catch(f){e=d.B||""}return J[c]=e})};const M={P:"application/font-woff",R:"application/font-woff",N:"application/font-truetype",v:"application/vnd.ms-fontobject",H:"image/png",F:"image/jpeg",D:"image/jpeg",A:"image/gif",M:"image/tiff",L:"image/svg+xml",O:"image/webp"};function N(a){return(a=/\.([^./]*?)$/g.exec(a))?a[1]:""};function O(a){return t(function*(){const b=a.toDataURL();return b==="data:,"?a.cloneNode(!1):B(b)})}function aa(a,b){return t(function*(){if(a.currentSrc){var d=document.createElement("canvas");const c=d.getContext("2d");d.width=a.clientWidth;d.height=a.clientHeight;c==null||c.drawImage(a,0,0,d.width,d.height);d=d.toDataURL();return B(d)}d=a.poster;d=yield L(d,M[N(d).toLowerCase()]||"",b);return B(d)})}
function ba(a,b){return t(function*(){try{let d;if(a==null?0:(d=a.contentDocument)==null?0:d.body)return yield P(a.contentDocument.body,b,!0)}catch(d){}return a.cloneNode(!1)})}function ca(a,b){return t(function*(){return E(a,HTMLCanvasElement)?O(a):E(a,HTMLVideoElement)?aa(a,b):E(a,HTMLIFrameElement)?ba(a,b):a.cloneNode(a.tagName!=null&&a.tagName.toUpperCase()==="SVG")})}
function da(a,b,d){return t(function*(){if(b.tagName!=null&&b.tagName.toUpperCase()==="SVG")return b;let c=[];if(a.tagName!=null&&a.tagName.toUpperCase()==="SLOT"&&a.assignedNodes)c=w(a.assignedNodes());else{let e;if(E(a,HTMLIFrameElement)&&((e=a.contentDocument)==null?0:e.body))c=w(a.contentDocument.body.childNodes);else{let f;c=w(((f=a.shadowRoot)!=null?f:a).childNodes)}}if(c.length===0||E(a,HTMLVideoElement))return b;yield c.reduce((e,f)=>e.then(()=>P(f,d)).then(g=>{g&&b.appendChild(g)}),Promise.resolve());
return b})}function ea(a,b,d){const c=b.style;if(c){var e=window.getComputedStyle(a);e.cssText?(c.cssText=e.cssText,c.transformOrigin=e.transformOrigin):y(d).forEach(f=>{let g=e.getPropertyValue(f);f==="font-size"&&g.endsWith("px")&&(g=`${Math.floor(parseFloat(g.substring(0,g.length-2)))-.1}px`);E(a,HTMLIFrameElement)&&f==="display"&&g==="inline"&&(g="block");f==="d"&&b.getAttribute("d")&&(g=`path(${b.getAttribute("d")})`);c.setProperty(f,g,e.getPropertyPriority(f))})}}
function fa(a,b){E(a,HTMLSelectElement)&&(b=Array.from(b.children).find(d=>a.value===d.getAttribute("value")))&&b.setAttribute("selected","")}
function ha(a,b){return t(function*(){var d=a.querySelectorAll?a.querySelectorAll("use"):[];if(d.length===0)return a;var c={};for(var e=0;e<d.length;e++){var f=d[e].getAttribute("xlink:href");if(f){const g=document.querySelector(f);a.querySelector(f)||!g||c[f]||(c[f]=yield P(g,b,!0))}}d=Object.values(c);if(d.length){c=document.createElementNS("http://www.w3.org/1999/xhtml","svg");c.setAttribute("xmlns","http://www.w3.org/1999/xhtml");c.style.position="absolute";c.style.width="0";c.style.height="0";
c.style.overflow="hidden";c.style.display="none";e=document.createElementNS("http://www.w3.org/1999/xhtml","defs");c.appendChild(e);for(f=0;f<d.length;f++)e.appendChild(d[f]);a.appendChild(c)}return a})}
function P(a,b,d){return t(function*(){return d||!b.filter||b.filter(a)?Promise.resolve(a).then(c=>ca(c,b)).then(c=>da(a,c,b)).then(c=>{E(c,Element)&&(ea(a,c,b),G(a,c,":before",b),G(a,c,":after",b),E(a,HTMLTextAreaElement)&&(c.textContent=a.value),E(a,HTMLInputElement)&&c.setAttribute("value",a.value),fa(a,c));return c}).then(c=>ha(c,b)):null})};const Q=/url\((['"]?)([^'"]+?)\1\)/g,ia=/url\([^)]+\)\s*format\((["']?)([^"']+)\1\)/g,ja=/src:\s*(?:url\([^)]+\)\s*format\([^)]+\)[,;]\s*)+/g;function ka(a){const b=[];a.replace(Q,(d,c,e)=>{b.push(e);return d});return b.filter(d=>!H(d))}
function la(a,b,d,c){return t(function*(){try{const e=d?(new URL(b,d||void 0)).toString():b;let f;f=yield L(e,M[N(b).toLowerCase()]||"",c);return a.replace(new RegExp(`(url\\(['"]?)(${b.replace(/([.*+?^${}()|\[\]\/\\])/g,"\\$1")})(['"]?\\))`,"g"),`$1${f}$3`)}catch(e){}return a})}function ma(a,{I:b}){return b?a.replace(ja,d=>{for(;;){const [c,,e]=ia.exec(d)||[],f=c,g=e;if(!g)return"";if(g===b)return`src: ${f};`}}):a}
function R(a,b,d){return t(function*(){if(a.search(Q)===-1)return a;const c=ma(a,d);return ka(c).reduce((e,f)=>e.then(g=>la(g,f,b,d)),Promise.resolve(c))})};function S(a,b,d){return t(function*(){var c;const e=(c=b.style)==null?void 0:c.getPropertyValue(a);return e?(c=yield R(e,null,d),b.style.setProperty(a,c,b.style.getPropertyPriority(a)),!0):!1})}function na(a,b){return t(function*(){(yield S("background",a,b))||(yield S("background-image",a,b));(yield S("mask",a,b))||(yield S("-webkit-mask",a,b))||(yield S("mask-image",a,b))||(yield S("-webkit-mask-image",a,b))})}
function oa(a,b){return t(function*(){const d=E(a,HTMLImageElement);if(d&&!H(a.src)||E(a,SVGImageElement)&&!H(a.href.baseVal)){var c=d?a.src:a.href.baseVal,e=yield L(c,M[N(c).toLowerCase()]||"",b);yield new Promise((f,g)=>{a.onload=f;a.onerror=b.m?(...k)=>{try{f(b.m(...k))}catch(m){g(m)}}:g;a.decode&&(a.decode=f);a.loading==="lazy"&&(a.loading="eager");d?(a.srcset="",a.src=e):a.href.baseVal=e})}})}
function pa(a,b){return t(function*(){const d=w(a.childNodes).map(c=>T(c,b));yield Promise.all(d).then(()=>a)})}function T(a,b){return t(function*(){E(a,Element)&&(yield na(a,b),yield oa(a,b),yield pa(a,b))})};const U={};function V(a){return t(function*(){var b=U[a];if(b!=null)return b;b=yield(yield fetch(a)).text();b={url:a,cssText:b};return U[a]=b})}function W(a,b){return t(function*(){let d=a.cssText;const c=/url\(["']?([^"')]+)["']?\)/g,e=(d.match(/url\([^)]+\)/g)||[]).map(f=>t(function*(){let g=f.replace(c,"$1");g.startsWith("https://")||(g=(new URL(g,a.url)).href);return I(g,b.i,({result:k})=>{d=d.replace(f,`url(${k})`);return[f,k]})}));return Promise.all(e).then(()=>d)})}
function X(a){if(a==null)return[];const b=[];a=a.replace(/(\/\*[\s\S]*?\*\/)/gi,"");for(var d=RegExp("((@.*?keyframes [\\s\\S]*?){([\\s\\S]*?}\\s*?)})","gi");;){var c=d.exec(a);if(c===null)break;b.push(c[0])}a=a.replace(d,"");d=/@import[\s\S]*?url\([^)]*\)[\s\S]*?;/gi;for(c=RegExp("((\\s*?(?:\\/\\*[\\s\\S]*?\\*\\/)?\\s*?@media[\\s\\S]*?){([\\s\\S]*?)}\\s*?})|(([\\s\\S]*?){([\\s\\S]*?)})","gi");;){let e=d.exec(a);if(e===null)if(e=c.exec(a),e===null)break;else d.lastIndex=c.lastIndex;else c.lastIndex=
d.lastIndex;b.push(e[0])}return b}
function qa(a,b){return t(function*(){const d=[],c=[];a.forEach(e=>{if("cssRules"in e)try{w(e.cssRules||[]).forEach((f,g)=>{if(f.type===CSSRule.IMPORT_RULE){let k=g+1;f=V(f.href).then(m=>W(m,b)).then(m=>X(m).forEach(q=>{try{e.insertRule(q,q.startsWith("@import")?k+=1:e.cssRules.length)}catch(Ca){}})).catch(()=>{});c.push(f)}})}catch(f){const g=a.find(k=>k.href==null)||document.styleSheets[0];e.href!=null&&c.push(V(e.href).then(k=>W(k,b)).then(k=>X(k).forEach(m=>{g.insertRule(m,g.cssRules.length)})).catch(()=>
{}))}});return Promise.all(c).then(()=>{a.forEach(e=>{if("cssRules"in e)try{w(e.cssRules||[]).forEach(f=>{d.push(f)})}catch(f){}});return d})})}function ra(a){return a.filter(b=>b.type===CSSRule.FONT_FACE_RULE).filter(b=>b.style.getPropertyValue("src").search(Q)!==-1)}function sa(a,b){return t(function*(){if(a.ownerDocument==null)throw Error("Provided element is not within a Document");var d=w(a.ownerDocument.styleSheets);d=yield qa(d,b);return ra(d)})}
function ta(a){function b(c){(c.style.fontFamily||getComputedStyle(c).fontFamily).split(",").forEach(e=>{d.add(e.trim().replace(/["']/g,""))});Array.from(c.children).forEach(e=>{e instanceof HTMLElement&&b(e)})}const d=new Set;b(a);return d}function ua(a,b){return t(function*(){const d=yield sa(a,b),c=ta(a);return(yield Promise.all(d.filter(e=>c.has(e.style.fontFamily.trim().replace(/["']/g,""))).map(e=>R(e.cssText,e.parentStyleSheet?e.parentStyleSheet.href:null,b)))).join("\n")})}
function va(a,b){return t(function*(){const d=b.j!=null?b.j:b.K?null:yield ua(a,b);if(d){const c=document.createElement("style");c.appendChild(document.createTextNode(d));a.firstChild?a.insertBefore(c,a.firstChild):a.appendChild(c)}})};function wa(a,b={}){return t(function*(){const {width:d,height:c}=A(a,b),e=yield P(a,b,!0);yield va(e,b);yield T(e,b);u(e,b);return yield D(e,d,c)})}
function xa(a,b={}){return t(function*(){const {width:d,height:c}=A(a,b);var e=yield wa(a,b);e=yield B(e);const f=document.createElement("canvas"),g=f.getContext("2d"),k=b.G||window.devicePixelRatio||1,m=b.h||d,q=b.g||c;f.width=m*k;f.height=q*k;!b.J&&(f.width>16384||f.height>16384)&&(f.width>16384&&f.height>16384?f.width>f.height?(f.height*=16384/f.width,f.width=16384):(f.width*=16384/f.height,f.height=16384):f.width>16384?(f.height*=16384/f.width,f.width=16384):(f.width*=16384/f.height,f.height=
16384));f.style.width=`${m}`;f.style.height=`${q}`;b.backgroundColor&&(g.fillStyle=b.backgroundColor,g.fillRect(0,0,f.width,f.height));g.drawImage(e,0,0,f.width,f.height);return f})}function Y(a,b={}){return t(function*(){return(yield xa(a,b)).toDataURL()})};const ya=["gemini.google.com","corp.google.com"];function Z(){return document.body.querySelectorAll('[class*="animate"]').length>0}function za(){return t(function*(){const a=document.body.offsetWidth,b=document.body.offsetHeight,d=document.body.cloneNode(!0);d.querySelectorAll('[class*="animate"]').forEach(c=>{c.classList.remove(...Array.from(c.classList).filter(e=>e.startsWith("animate")))});d.style.width=`${a}px`;d.style.height=`${b}px`;return d})}
function Aa(a){return t(function*(){let b=document.body;if(Z()){var d=yield za();b=d;document.body.appendChild(d)}d=yield Y(b,{h:b.offsetWidth,g:b.offsetHeight});Z()&&document.body.removeChild(b);window.parent.postMessage({type:"SEND_SCREENSHOT",image:d,topOffset:document.documentElement.scrollTop},a.origin)})}
function Ba(a){return t(function*(){var b=document.body;b={type:"SEND_SCREENSHOT_FOR_DATA_VISUALIZATION",image:yield Y(b,{h:b.offsetWidth,g:b.offsetHeight}),topOffset:0};window.parent.postMessage(b,a.origin)})}window.addEventListener("message",a=>t(function*(){if(ya.some(d=>a.origin.includes(d))){var b=a.data;b&&(b.type==="MAKE_SCREENSHOT"&&(yield Aa(a)),b.type==="MAKE_SCREENSHOT_FOR_DATA_VISUALIZATION"&&(yield Ba(a)))}}));
</script><script>(function() {
  // Ensure this script is executed only once
  if (window.firebaseAuthBridgeScriptLoaded) {
    return;
  }
  window.firebaseAuthBridgeScriptLoaded = true;

  let nextTokenPromiseId = 0;

  // Stores { resolve, reject } for ongoing token requests
  const pendingTokenPromises = {};

  // Listen for messages from the Host Application
  window.addEventListener('message', function(event) {

    const messageData = event.data;

  if (messageData && messageData.type === 'RESOLVE_NEW_FIREBASE_TOKEN') {
      const { success, token, error, promiseId } = messageData ?? {};
      if (pendingTokenPromises[promiseId]) {
        if (success) {
          pendingTokenPromises[promiseId].resolve(token);
        } else {
          pendingTokenPromises[promiseId].reject(new Error(error || 'Token refresh failed from host.'));
        }
        delete pendingTokenPromises[promiseId];
      }
    }
  });

  // Expose a function for the Generated App to request a new Firebase token
  window.requestNewFirebaseToken = function() {
    const currentPromiseId = nextTokenPromiseId++;
    const promise = new Promise((resolve, reject) => {
      pendingTokenPromises[currentPromiseId] = { resolve, reject };
    });
    if (window.parent && window.parent !== window) {
      window.parent.postMessage({
        type: 'REQUEST_NEW_FIREBASE_TOKEN',
        promiseId: currentPromiseId
      }, '*');
    } else {
      pendingTokenPromises[currentPromiseId].reject(new Error('No parent window to request token from.'));
      delete pendingTokenPromises[currentPromiseId];
    }
    return promise;
  };
})();</script><script>
let realOriginalGetUserMedia = null;
if (navigator.mediaDevices && navigator.mediaDevices.getUserMedia) {
  realOriginalGetUserMedia = navigator.mediaDevices.getUserMedia.bind(navigator.mediaDevices);
}

(function() {
  if (navigator.mediaDevices && navigator.mediaDevices.__proto__) {
    try {
      Object.defineProperty(navigator.mediaDevices.__proto__, 'getUserMedia', {
        get: function() {
          return undefined; // Or throw an error
        },
        configurable: false
      });
    } catch (error) {
      console.error("Error defining prototype getter:", error);
    }
  }
})();

(function() {
  const pendingMediaResolvers = {};
  let nextMediaPromiseId = 0;

  function requestMediaPermissions(constraints) {
    const mediaPromiseId = nextMediaPromiseId++;
    const promise = new Promise((resolve, reject) => {
      pendingMediaResolvers[mediaPromiseId] = (granted) => {
        delete pendingMediaResolvers[mediaPromiseId];
        resolve(granted);
      };
    });

    window.parent.postMessage({
      type: 'requestMediaPermission',
      constraints: constraints,
      promiseId: mediaPromiseId,
    }, '*');

    return promise;
  }

  let originalGetUserMedia = realOriginalGetUserMedia;

  function interceptGetUserMedia() {
    if (navigator.mediaDevices) {
      Object.defineProperty(navigator.mediaDevices, 'getUserMedia', {
        value: function(constraints) {
          return requestMediaPermissions(constraints).then((granted) => {
            if (granted) {
              if (originalGetUserMedia) {
                return originalGetUserMedia(constraints);
              } else {
                throw new Error("Original getUserMedia not available.");
              }
            } else {
              throw new DOMException('Permission denied', 'NotAllowedError');
            }
          });
        },
        writable: false,
        configurable: false
      });
    }
  }

  interceptGetUserMedia();

  const observer = new MutationObserver(function(mutationsList, observer) {
    for (const mutation of mutationsList) {
      if (mutation.type === 'reconfigured' && mutation.name === 'getUserMedia' && mutation.object === navigator.mediaDevices) {
        interceptGetUserMedia();
      } else if (mutation.type === 'attributes' && mutation.attributeName === 'getUserMedia' && mutation.target === navigator.mediaDevices) {
        interceptGetUserMedia();
      } else if (mutation.type === 'childList' && mutation.addedNodes) {
        mutation.addedNodes.forEach(node => {
          if (node === navigator.mediaDevices) {
            interceptGetUserMedia();
          }
        });
      }
    }
  });

  function interceptSpeechRecognition() {
    if (!window.SpeechRecognition && !window.webkitSpeechRecognition) {
      return;
    }

    const OriginalSpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;

    const SpeechRecognitionWrapper = function(...args) {
      const recognizer = new OriginalSpeechRecognition(...args);
      const originalStart = recognizer.start.bind(recognizer);

      recognizer.start = function() {
        requestMediaPermissions({ audio: true }).then(granted => {
          if (granted) {
            originalStart();
          } else {
            const errorEvent = new SpeechRecognitionErrorEvent('error');
            errorEvent.error = 'not-allowed'; // This is the standard error for permission denial.
            recognizer.dispatchEvent(errorEvent);
          }
        });
      };

      return recognizer;
    };

    SpeechRecognitionWrapper.prototype = OriginalSpeechRecognition.prototype;
    SpeechRecognitionWrapper.prototype.constructor = SpeechRecognitionWrapper;

    if (window.SpeechRecognition) {
      window.SpeechRecognition = SpeechRecognitionWrapper;
    }
    if (window.webkitSpeechRecognition) {
      window.webkitSpeechRecognition = SpeechRecognitionWrapper;
    }
  }

  interceptSpeechRecognition();

  window.addEventListener('message', function(event) {
    if (event.data) {
      if (event.data.type === 'resolveMediaPermission') {
        const { promiseId, granted } = event.data;
        if (pendingMediaResolvers[promiseId]) {
          pendingMediaResolvers[promiseId](granted);
        }
      }
    }
  });

})();</script><script>((function(modelInformation) {
  const originalFetch = window.fetch;
  // TODO: b/421908508 - Move these out of the script and match all generative AI model calls.
  let googleLlmBaseApiUrls = [
    'https://generativelanguage.googleapis.com/v1beta/models/' + modelInformation.textModelName + ':streamGenerateContent',
    'https://generativelanguage.googleapis.com/v1beta/models/' + modelInformation.textModelName + ':generateContent',
    'https://generativelanguage.googleapis.com/v1beta/models/' + modelInformation.imageModelName + ':predict',
    'https://generativelanguage.googleapis.com/v1beta/models/' + modelInformation.imageModelName + ':predictLongRunning',
    'https://generativelanguage.googleapis.com/v1beta/models/' + modelInformation.imageEditModelName + ':generateContent',
    'https://generativelanguage.googleapis.com/v1beta/models/' + modelInformation.videoModelName + ':predict',
    'https://generativelanguage.googleapis.com/v1beta/models/' + modelInformation.videoModelName + ':predictLongRunning',
    'https://generativelanguage.googleapis.com/v1beta/models/' + modelInformation.ttsModelName + ':generateContent',
  ];
  modelInformation.deprecatedTextModelNames.forEach((modelName) => {
    googleLlmBaseApiUrls.push(
      'https://generativelanguage.googleapis.com/v1beta/models/' + modelName + ':streamGenerateContent',
      'https://generativelanguage.googleapis.com/v1beta/models/' + modelName + ':generateContent',
    );
  });

  const pendingFetchResolvers = {};
  let nextPromiseId = 0;

  function handleStringInput(input, optionsArgument) {
    const actualUrl = input;
    const fetchCallArgs = [actualUrl, optionsArgument];
    const effectiveOptions = optionsArgument || {};
    const bodyForApiKeyCheck = effectiveOptions.body;
    const bodyForPostMessage = effectiveOptions.body;
    return { actualUrl, fetchCallArgs, effectiveOptions, bodyForApiKeyCheck, bodyForPostMessage };
  }

  function handleRequestInput(input, optionsArgument) {
    const actualUrl = input.url;
    const fetchCallArgs = [input, optionsArgument];
    const effectiveOptions = { method: input.method, headers: new Headers(input.headers) };
    let bodyForApiKeyCheck;
    let bodyForPostMessage;

    if (optionsArgument) {
      if (optionsArgument.method) effectiveOptions.method = optionsArgument.method;
      if (optionsArgument.headers) effectiveOptions.headers = new Headers(optionsArgument.headers);
      if ('body' in optionsArgument) {
        bodyForApiKeyCheck = optionsArgument.body;
        bodyForPostMessage = optionsArgument.body;
      } else {
        bodyForApiKeyCheck = undefined;
        bodyForPostMessage = input.body;
      }
    } else {
      bodyForApiKeyCheck = undefined;
      bodyForPostMessage = input.body;
    }
    return { actualUrl, fetchCallArgs, effectiveOptions, bodyForApiKeyCheck, bodyForPostMessage };
  }

  window.fetch = function(input, optionsArgument) {
    let actualUrl;
    let fetchCallArgs;
    let effectiveOptions = {};
    let bodyForApiKeyCheck;
    let bodyForPostMessage;

    if (typeof input === 'string') {
      ({actualUrl, fetchCallArgs, effectiveOptions, bodyForApiKeyCheck, bodyForPostMessage} = handleStringInput(input, optionsArgument));
    } else if (input instanceof Request) {
      ({actualUrl, fetchCallArgs, effectiveOptions, bodyForApiKeyCheck, bodyForPostMessage} = handleRequestInput(input, optionsArgument));
    } else {
      return originalFetch.apply(window, [input, optionsArgument]);
    }

    effectiveOptions.method = effectiveOptions.method || 'GET';
    if (!effectiveOptions.headers) {
      effectiveOptions.headers = new Headers();
    }


    if (typeof actualUrl === 'string' && googleLlmBaseApiUrls.some((url) => actualUrl.startsWith(url))) {
      let apiKeyIsNull = true;

      const regex = new RegExp("models/([^:]+)");
      const modelNameMatch = actualUrl.match(regex);
      const modelName = modelNameMatch ? modelNameMatch[1] : 'unspecified';


      try {
        const urlObject = new URL(actualUrl);  // Use URL object for robust parsing
        const apiKeyParam = urlObject.searchParams.get('key');
        if (apiKeyParam) {
          apiKeyIsNull = false;
        }
      } catch (e) {
        // Continue checks even if URL parsing fails
      }

      if (apiKeyIsNull && effectiveOptions.headers) {
        const h = new Headers(effectiveOptions.headers);
        const apiKeyHeaderValue = h.get('X-API-Key') || h.get('x-api-key');
        if (apiKeyHeaderValue) {
          apiKeyIsNull = false;
          return originalFetch.apply(window, fetchCallArgs);
        }
      }

      if (apiKeyIsNull && effectiveOptions.method && ['POST', 'PUT', 'PATCH'].includes(effectiveOptions.method.toUpperCase()) && typeof bodyForApiKeyCheck === 'string') {
        try {
          const bodyData = JSON.parse(bodyForApiKeyCheck);
          if (bodyData && bodyData.apiKey) {
            apiKeyIsNull = false;
            return originalFetch.apply(window, fetchCallArgs);
          }
        } catch (e) {
          // Ignore JSON parsing errors
        }
      }

      if(apiKeyIsNull) {
        const promiseId = nextPromiseId++;
        const promise = new Promise((resolve) => {
          pendingFetchResolvers[promiseId] = (resolvedResponse) => {
            delete pendingFetchResolvers[promiseId];
            resolve(resolvedResponse);
          };
        });

        let serializedBodyForPostMessage;
        if (typeof bodyForPostMessage === 'string' || bodyForPostMessage == null) {
            serializedBodyForPostMessage = bodyForPostMessage;
        } else if (bodyForPostMessage instanceof ReadableStream) {
            serializedBodyForPostMessage = null;
        } else {
            try {
                serializedBodyForPostMessage = JSON.stringify(bodyForPostMessage);
            } catch (e) {
                serializedBodyForPostMessage = null;
            }
        }

        const messageOptions = {
            method: effectiveOptions.method,
            headers: Object.fromEntries(new Headers(effectiveOptions.headers).entries()),
            body: serializedBodyForPostMessage
        };

        window.parent.postMessage({
          type: 'requestFetch',
          url: actualUrl,
          modelName: modelName,
          options: messageOptions,
          promiseId: promiseId,
        }, '*');

        return promise;
      }
      return originalFetch.apply(window, fetchCallArgs);
    }
    return originalFetch.apply(window, fetchCallArgs);
  };

  window.addEventListener('message', function(event) {
    if (event.data && event.data.type === 'resolveFetch') {
      const { promiseId, response } = event.data;
      if (pendingFetchResolvers[promiseId]) {
        try {
          const reconstructedResponse = new Response(response.body, {
            status: response.status,
            statusText: response.statusText,
            headers: new Headers(response.headers),
          });
          pendingFetchResolvers[promiseId](reconstructedResponse);
        } catch (error) {
          pendingFetchResolvers[promiseId](new Response(null, { status: 500, statusText: "Interceptor Response Reconstruction Error" }));
        }
      }
    }
  });

}))({"textModelName":"gemini-2.5-flash-preview-05-20","imageModelName":"imagen-3.0-generate-002","imageEditModelName":"gemini-2.5-flash-image-preview","videoModelName":"veo-2.0-generate-001","ttsModelName":"gemini-2.5-flash-preview-tts","deprecatedTextModelNames":["gemini-2.0-flash","gemini-2.5-flash-preview-04-17"]})</script><script>(function() {
  const originalConsoleLog = console.log;
  const originalConsoleError = console.error;

    /**
   * Normalizes an error event or a promise rejection reason into a structured error object.
   * @param {*} errorEventOrReason The error object or reason.
   * @return {object} Structured error data { message, name, stack }.
   */
  function getErrorObject(errorEventOrReason) {
    if (errorEventOrReason instanceof Error) {
      return {
        message: errorEventOrReason.message,
        name: errorEventOrReason.name,
        stack: errorEventOrReason.stack,
      };
    }
    // Fallback for non-Error objects.
    try {
      return {
        message: JSON.stringify(errorEventOrReason),
        name: 'UnknownErrorType',
        stack: null,
      };
    } catch (e) {
      return {
        message: String(errorEventOrReason),
        name: 'UnknownErrorTypeNonStringifiable',
        stack: null,
      };
    }
  }

  /**
   * Converts an array of arguments (from log/error) into a single string.
   * Handles Error objects specially to include their message and stack.
   * @param {Array<*>} args - Arguments passed to console methods.
   * @return {string} A string representation of the arguments.
   */
  function stringifyArgs(args) {
    return args
      .map((arg) => {
        if (arg instanceof Error) {
          const {message, stack} = arg;
          return `Error: ${message}${stack ? ('\nStack: ' + stack) : ''}`;
        }
        if (typeof arg === 'object' && arg !== null) {
          try {
            return JSON.stringify(arg);
          } catch (error) {
            return '[Circular Object]';
          }
        } else {
          return String(arg);
        }
      })
      .join(' ');
  }

  console.log = function(...args) {
    const logString = stringifyArgs(args);
    window.parent.postMessage({ type: 'log', message: logString }, '*');
    originalConsoleLog.apply(console, args);
  };

  console.error = function(...args) {
    let errorData;
    if (args.length > 0 && args[0] instanceof Error) {
      const err = args[0];
      // If the first arg is an Error, capture its details.
      errorData = {
        type: 'error',
        source: 'CONSOLE_ERROR',
        ...getErrorObject(err),
        rawArgsString: stringifyArgs(args.slice(1)),
        timestamp: new Date().toISOString(),
      };
    } else {
      // If not an Error object, treat all args as a general error message.
      errorData = {
        type: 'error',
        source: 'CONSOLE_ERROR',
        message: stringifyArgs(args),
        name: 'ConsoleLoggedError',
        stack: null,
        timestamp: new Date().toISOString(),
      };
    }
    window.parent.postMessage(errorData, '*');
    originalConsoleError.apply(console, args);
  };

  // Listen for global unhandled synchronous errors.
  window.addEventListener('error', function(event) {
    const errorDetails = event.error ? getErrorObject(event.error) : {
      message: event.message,
      name: 'GlobalError',
      stack: null,
      filename: event.filename,
      lineno: event.lineno,
      colno: event.colno,
    };

    window.parent.postMessage({
      type: 'error',
      source: 'global',
      ...errorDetails,
      message: errorDetails.message || event.message,
      timestamp: new Date().toISOString(),
    }, '*');
  });

  // Listen for unhandled promise rejections (asynchronous errors).
  window.addEventListener('unhandledrejection', function(event) {
    const errorDetails = getErrorObject(event.reason);

    window.parent.postMessage({
      type: 'error',
      source: 'unhandledrejection',
      ...errorDetails,
      message: errorDetails.message || 'Unhandled Promise Rejection',
      timestamp: new Date().toISOString(),
    }, '*');
  });

})();</script>
    
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Learning App</title>
    <script src="https://cdn.tailwindcss.com/"></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.10/dist/katex.min.css" integrity="sha340-wcIxkf4k55untgPhT5QIwSCTf5lC5H4fyqECSeL16oPNRwZXHNlXf5Xc3" crossorigin="anonymous">
    <script src="https://cdn.jsdelivr.net/npm/katex@0.16.10/dist/katex.min.js" integrity="sha340-hG0zfxD7T89y/K43P/Xj3h/U4M77L1M6p75N7b4a6o5o6n9zK49k8/G+fH5q7/g5" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/katex@0.16.10/dist/contrib/auto-render.min.js" integrity="sha340-yFIhU+SliQu5L4hJ0Q9v7c+V3B4P5I7v2g/aJ5D7k8f8p5O6zE9y6y8y" crossorigin="anonymous"></script>
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getAuth, signInAnonymously, signInWithCustomToken, createUserWithEmailAndPassword, signInWithEmailAndPassword, signOut, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { getFirestore, collection, addDoc, getDocs, onSnapshot, query, orderBy, serverTimestamp, setLogLevel } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";
        
        // Global variables provided by the environment
        const appId = typeof __app_id !== 'undefined' ? __app_id : 'default-app-id';
        const firebaseConfig = JSON.parse(typeof __firebase_config !== 'undefined' ? __firebase_config : '{}');
        const initialAuthToken = typeof __initial_auth_token !== 'undefined' ? __initial_auth_token : null;
        
        setLogLevel('debug');
        
        let app, db, auth;
        let userId = '';
        let score = 0;
        let unsubscribeChat = null;

        // Game state variables
        let quickMathTimer = null;
        let quickMathTimeLeft = 30;
        let quickMathScore = 0;
        let quickMathCurrentAnswer = 0;
        let guessNumber = Math.floor(Math.random() * 100) + 1;
        let guessCount = 0;

        // Calculator state
        const calculator = {
            displayValue: '0',
            firstOperand: null,
            waitingForSecondOperand: false,
            operator: null,
        };

        window.onload = async () => {
            try {
                if (Object.keys(firebaseConfig).length > 0) {
                    app = initializeApp(firebaseConfig);
                    auth = getAuth(app);
                    db = getFirestore(app);

                    onAuthStateChanged(auth, async (user) => {
                        console.log("Authentication state changed:", user ? user.uid : "null");
                        if (user) {
                            userId = user.email || user.uid;
                            document.getElementById('userIdDisplay').textContent = `User: ${userId}`;
                            document.getElementById('auth-buttons').classList.add('hidden');
                            document.getElementById('signout-btn').classList.remove('hidden');
                            setupChatListener();
                        } else {
                            userId = 'Anonymous';
                            document.getElementById('userIdDisplay').textContent = `User: ${userId}`;
                            document.getElementById('auth-buttons').classList.remove('hidden');
                            document.getElementById('signout-btn').classList.add('hidden');
                            if (unsubscribeChat) {
                                unsubscribeChat();
                                unsubscribeChat = null;
                            }
                        }
                    });

                    if (initialAuthToken) {
                        await signInWithCustomToken(auth, initialAuthToken);
                        console.log("Signed in with custom token.");
                    } else {
                        await signInAnonymously(auth);
                        console.log("Signed in anonymously.");
                    }

                } else {
                    console.warn("Firebase config not available. Running without database features.");
                    userId = 'Anonymous';
                    document.getElementById('userIdDisplay').textContent = `User: ${userId}`;
                    document.getElementById('auth-buttons').classList.remove('hidden');
                    document.getElementById('signout-btn').classList.add('hidden');
                }
            } catch (error) {
                console.error("Firebase initialization failed:", error);
                userId = 'Anonymous';
                document.getElementById('userIdDisplay').textContent = `User: ${userId}`;
                document.getElementById('auth-buttons').classList.remove('hidden');
                document.getElementById('signout-btn').classList.add('hidden');
            }

            window.renderMath = () => {
                renderMathInElement(document.body, {
                    delimiters: [
                        {left: "$$", right: "$$", display: true},
                        {left: "\\[", right: "\\]", display: true},
                        {left: "$", right: "$", display: false},
                        {left: "\\(", right: "\\)", display: false}
                    ],
                    throwOnError: false
                });
            };

            setupEventListeners();
            showView('home');
            window.renderMath();
        };

        const equations = [
            { question: "Solve for $x$: $5x + 3 = 18$", answer: 3 },
            { question: "Solve for $y$: $2y - 7 = 11$", answer: 9 },
            { question: "Solve for $z$: $4(z + 2) = 20$", answer: 3 },
            { question: "Solve for $a$: $\\frac{a}{2} - 1 = 4$", answer: 10 },
        ];

        const languages = [
            { question: "What is the Kiswahili word for 'Thank you'?", options: ["Asante", "Jambo", "Sawa", "Pole"], answer: "Asante" },
            { question: "What is the French word for 'Dog'?", options: ["Chat", "Chien", "Oiseau", "Poisson"], answer: "Chien" },
            { question: "How do you say 'Water' in Hebrew?", options: ["לחם (Lechem)", "מים (Mayim)", "שמש (Shemesh)", "בית (Bayit)"], answer: "מים (Mayim)" },
        ];
        
        const iqQuestions = [
            { question: "Which number is the odd one out? 4, 9, 16, 20, 25", options: ["4", "9", "16", "20", "25"], answer: "20" },
            { question: "What is the next number in the sequence? 1, 1, 2, 3, 5, 8, 13", options: ["18", "21", "24", "27", "30"], answer: "21" },
        ];
        
        const testQuizzes = [
            { question: "What is the capital of Australia?", options: ["Sydney", "Melbourne", "Canberra", "Perth"], answer: "Canberra" },
            { question: "Who wrote 'Romeo and Juliet'?", options: ["Charles Dickens", "William Shakespeare", "Jane Austen", "Mark Twain"], answer: "William Shakespeare" },
        ];

        const historyFacts = {
            1969: "Apollo 11 lands on the Moon.",
            1991: "The World Wide Web becomes publicly available.",
            2007: "The first iPhone is released.",
        };
        
        const funFacts = [
            "A group of flamingos is called a 'flamboyance'.",
            "The shortest war in history was between Britain and Zanzibar on August 27, 1896. It lasted only 38 minutes.",
            "Octopuses have three hearts.",
        ];

        const educationalVideos = [
            { title: "The Science of a Solar Eclipse", url: "https://www.youtube.com/embed/nU61e0bF238" },
            { title: "How the Internet Works", url: "https://www.youtube.com/embed/u-i_f1p_m8g" },
        ];

        let currentQuizData = [];
        let currentIndex = 0;

        async function saveScoreToFirestore() {
            if (!db || !auth.currentUser) {
                console.error("Not signed in or Firestore not initialized. Score will not be saved.");
                return;
            }
            try {
                const leaderboardCollection = collection(db, `artifacts/${appId}/public/data/leaderboard`);
                await addDoc(leaderboardCollection, {
                    userId: auth.currentUser.email || auth.currentUser.uid,
                    score: score,
                    timestamp: new Date()
                });
                console.log("Score saved successfully!");
            } catch (e) {
                console.error("Error adding document: ", e);
            }
        }
        
        async function fetchAndDisplayLeaderboard() {
            if (!db) {
                console.error("Firestore not initialized. Cannot fetch leaderboard.");
                return;
            }
            const leaderboardTable = document.getElementById('leaderboardTable');
            leaderboardTable.querySelector('tbody').innerHTML = '<tr><td colspan="3" class="text-center py-4">Loading...</td></tr>';

            try {
                const leaderboardCollection = collection(db, `artifacts/${appId}/public/data/leaderboard`);
                const querySnapshot = await getDocs(leaderboardCollection);
                const scores = [];
                querySnapshot.forEach((doc) => {
                    scores.push(doc.data());
                });

                scores.sort((a, b) => b.score - a.score);

                const topScores = scores.slice(0, 10);
                const tbody = leaderboardTable.querySelector('tbody');
                tbody.innerHTML = '';
                if (topScores.length > 0) {
                    topScores.forEach((entry, index) => {
                        const row = `
                            <tr class="border-b border-gray-200 hover:bg-gray-50 transition-colors">
                                <td class="px-6 py-3">${index + 1}</td>
                                <td class="px-6 py-3">${entry.userId}</td>
                                <td class="px-6 py-3 font-bold">${entry.score}</td>
                            </tr>
                        `;
                        tbody.innerHTML += row;
                    });
                } else {
                    tbody.innerHTML = '<tr><td colspan="3" class="text-center py-4 text-gray-500">No scores yet! Be the first to play.</td></tr>';
                }
            } catch (e) {
                console.error("Error fetching leaderboard: ", e);
                leaderboardTable.querySelector('tbody').innerHTML = '<tr><td colspan="3" class="text-center py-4 text-red-500">Error loading scores.</td></tr>';
            }
        }

        function showView(viewName) {
            document.querySelectorAll('.app-view').forEach(view => {
                view.classList.add('hidden');
                view.classList.remove('animate-fade-in');
            });
            const viewElement = document.getElementById(viewName + '-view');
            viewElement.classList.remove('hidden');
            viewElement.classList.add('animate-fade-in');
            
            if (unsubscribeChat) {
                unsubscribeChat();
                unsubscribeChat = null;
            }

            stopQuickMath();

            if (viewName === 'home') {
                score = 0;
                updateScoreDisplay();
            } else if (viewName === 'chat' && db && auth.currentUser) {
                setupChatListener();
            } else if (viewName === 'fun-facts') {
                showRandomFunFact();
            } else if (viewName === 'calculator') {
                resetCalculator();
                updateCalculatorDisplay();
            }
        }

        function updateScoreDisplay() {
            document.getElementById('scoreDisplay').textContent = `Score: ${score}`;
        }
        
        function handleSignUp() {
            const email = document.getElementById('signup-email').value;
            const password = document.getElementById('signup-password').value;
            createUserWithEmailAndPassword(auth, email, password)
                .then(() => showMessage("Signup successful! You are now logged in.", 'green'))
                .catch((error) => showMessage(`Signup failed: ${error.message}`, 'red'));
        }

        function handleSignIn() {
            const email = document.getElementById('signin-email').value;
            const password = document.getElementById('signin-password').value;
            signInWithEmailAndPassword(auth, email, password)
                .then(() => showMessage("Signin successful! Welcome back.", 'green'))
                .catch((error) => showMessage(`Signin failed: ${error.message}`, 'red'));
        }
        
        function handleSignOut() {
            signOut(auth).then(() => showMessage("Signed out successfully.", 'green'))
            .catch((error) => showMessage(`Signout failed: ${error.message}`, 'red'));
        }

        function showMessage(message, type) {
            const messageBox = document.getElementById('authMessageBox');
            messageBox.textContent = message;
            messageBox.className = `px-4 py-2 mt-4 rounded-md font-semibold text-white ${type === 'green' ? 'bg-green-500' : 'bg-red-500'}`;
            messageBox.classList.remove('hidden');
        }

        function setupEventListeners() {
            document.getElementById('equations-btn').addEventListener('click', () => startQuiz(equations));
            document.getElementById('language-btn').addEventListener('click', () => startQuiz(languages));
            document.getElementById('iq-btn').addEventListener('click', () => startQuiz(iqQuestions));
            document.getElementById('test-quiz-btn').addEventListener('click', () => startQuiz(testQuizzes));
            
            document.getElementById('videos-btn').addEventListener('click', () => {
                showView('videos');
                loadVideo(educationalVideos[0].url);
            });
            
            document.getElementById('chat-btn').addEventListener('click', () => showView('chat'));
            document.getElementById('dictionary-btn').addEventListener('click', () => showView('dictionary'));
            document.getElementById('fun-facts-btn').addEventListener('click', () => showView('fun-facts'));
            document.getElementById('leaderboard-btn').addEventListener('click', () => {
                showView('leaderboard');
                fetchAndDisplayLeaderboard();
            });
            document.getElementById('search-btn').addEventListener('click', () => showView('search'));
            document.getElementById('history-btn').addEventListener('click', () => showView('history'));
            document.getElementById('ai-assistant-btn').addEventListener('click', () => showView('ai-assistant'));
            document.getElementById('games-btn').addEventListener('click', () => showView('games'));
            document.getElementById('calculator-btn').addEventListener('click', () => showView('calculator'));
            document.getElementById('weather-btn').addEventListener('click', () => showView('weather'));

            document.getElementById('quick-math-btn').addEventListener('click', () => {
                showView('quick-math');
                startQuickMath();
            });
            document.getElementById('guess-number-btn').addEventListener('click', () => {
                showView('guess-number');
                resetGuessNumber();
            });
            document.getElementById('quickMathSubmitBtn').addEventListener('click', checkQuickMathAnswer);
            document.getElementById('quickMathInput').addEventListener('keydown', (e) => { if (e.key === 'Enter') checkQuickMathAnswer(); });
            document.getElementById('guessNumberSubmitBtn').addEventListener('click', checkGuessNumber);
            document.getElementById('guessNumberInput').addEventListener('keydown', (e) => { if (e.key === 'Enter') checkGuessNumber(); });
            document.getElementById('guessNumberResetBtn').addEventListener('click', resetGuessNumber);
            
            document.getElementById('signup-btn').addEventListener('click', () => showView('signup'));
            document.getElementById('signin-btn').addEventListener('click', () => showView('signin'));
            document.getElementById('signout-btn').addEventListener('click', handleSignOut);
            
            document.getElementById('signup-submit-btn').addEventListener('click', handleSignUp);
            document.getElementById('signin-submit-btn').addEventListener('click', handleSignIn);

            document.getElementById('submitBtn').addEventListener('click', () => checkAnswer());
            document.getElementById('equationInput').addEventListener('keydown', (e) => { if (e.key === 'Enter') checkAnswer(); });

            document.getElementById('nextBtn').addEventListener('click', () => {
                currentIndex++;
                if (currentIndex < currentQuizData.length) {
                    generateQuestion();
                    document.getElementById('messageBox').classList.add('hidden');
                } else {
                    document.getElementById('quizQuestion').innerHTML = "Quiz complete!";
                    document.getElementById('quizAction').classList.add('hidden');
                    document.getElementById('messageBox').classList.add('hidden');
                    saveScoreToFirestore();
                    showView('post-quiz');
                    document.getElementById('postQuizQuestion').innerHTML = equations[Math.floor(Math.random() * equations.length)].question;
                    window.renderMath();
                }
            });

            document.getElementById('searchInput').addEventListener('input', (e) => {
                const query = e.target.value.toLowerCase();
                const results = equations.filter(eq => eq.question.toLowerCase().includes(query));
                displaySearchResults(results);
            });
            
            document.getElementById('yearInput').addEventListener('input', (e) => {
                const year = e.target.value;
                const fact = historyFacts[year] || "No fact found for that year.";
                document.getElementById('historyResult').textContent = fact;
            });
            
            document.querySelectorAll('.video-select-btn').forEach(btn => btn.addEventListener('click', (e) => loadVideo(e.target.dataset.url)));
            document.getElementById('dictionarySearchBtn').addEventListener('click', searchDictionary);
            document.getElementById('dictionaryInput').addEventListener('keydown', (e) => { if (e.key === 'Enter') searchDictionary(); });
            document.getElementById('newFactBtn').addEventListener('click', showRandomFunFact);
            document.getElementById('chatInput').addEventListener('keydown', (e) => { if (e.key === 'Enter') sendMessage(); });
            document.getElementById('chatSendBtn').addEventListener('click', sendMessage);
            document.getElementById('aiInput').addEventListener('keydown', (e) => { if (e.key === 'Enter') { askAI(e.target.value); e.target.value = ''; } });
            document.getElementById('aiSendBtn').addEventListener('click', () => { const input = document.getElementById('aiInput'); askAI(input.value); input.value = ''; });
            document.getElementById('clearChatBtn').addEventListener('click', () => { document.getElementById('chatContainer').innerHTML = ''; });
            document.querySelectorAll('.back-to-home-btn').forEach(btn => btn.addEventListener('click', () => showView('home')));
            
            document.getElementById('calculator-keys').addEventListener('click', handleCalculatorClick);
            document.getElementById('getWeatherBtn').addEventListener('click', getWeather);
            document.getElementById('cityInput').addEventListener('keydown', (e) => { if (e.key === 'Enter') getWeather(); });
        }
        
        function startQuiz(quizData) {
            currentQuizData = quizData;
            currentIndex = 0;
            showView('quiz');
            document.getElementById('equationInput').classList.toggle('hidden', quizData !== equations);
            document.getElementById('optionButtons').classList.toggle('hidden', quizData === equations);
            generateQuestion();
        }

        async function askAI(query) {
            if (!query) return;
            const chatContainer = document.getElementById('chatContainer');
            chatContainer.innerHTML += `<div class="flex justify-end mb-4"><div class="bg-blue-500 text-white rounded-lg p-3 max-w-xs shadow-md">${query}</div></div>`;
            const aiMessage = document.createElement('div');
            aiMessage.className = "flex justify-start mb-4";
            aiMessage.innerHTML = `<div class="bg-gray-200 text-gray-800 rounded-lg p-3 max-w-xs shadow-md">...</div>`;
            chatContainer.appendChild(aiMessage);
            chatContainer.scrollTop = chatContainer.scrollHeight;

            const apiKey = "";
            const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-05-20:generateContent?key=${apiKey}`;
            
            try {
                const response = await fetch(apiUrl, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ contents: [{ parts: [{ text: query }] }], tools: [{ "google_search": {} }] })
                });
                
                if (!response.ok) throw new Error(`API call failed: ${response.status}`);

                const result = await response.json();
                const responseText = result.candidates?.[0]?.content?.parts?.[0]?.text || "I couldn't get an answer.";
                aiMessage.innerHTML = `<div class="bg-gray-200 text-gray-800 rounded-lg p-3 max-w-xs shadow-md">${responseText}</div>`;
                window.renderMath();
            } catch (error) {
                console.error("Error asking AI:", error);
                aiMessage.innerHTML = `<div class="bg-gray-200 text-red-500 rounded-lg p-3 max-w-xs shadow-md">Error. Please try again.</div>`;
            }
            chatContainer.scrollTop = chatContainer.scrollHeight;
        }

        function displaySearchResults(results) {
            const container = document.getElementById('searchResults');
            container.innerHTML = results.length ? results.map(r => `<div class="p-4 bg-gray-50 rounded-lg text-left shadow-inner text-lg text-gray-700">${r.question}</div>`).join('') : `<p class="text-center text-gray-500 py-4">No equations found.</p>`;
            window.renderMath();
        }

        function generateQuestion() {
            const currentQuestion = currentQuizData[currentIndex];
            document.getElementById('quizQuestion').innerHTML = currentQuestion.question;
            document.getElementById('quizAction').classList.remove('hidden');
            document.getElementById('nextBtn').classList.add('hidden');
            document.getElementById('submitBtn').classList.remove('hidden');

            if (currentQuizData === equations) {
                document.getElementById('equationInput').value = "";
                document.getElementById('equationInput').focus();
            } else {
                const optionsContainer = document.getElementById('optionButtons');
                optionsContainer.innerHTML = '';
                currentQuestion.options.forEach(option => {
                    const button = document.createElement('button');
                    button.textContent = option;
                    button.className = "flex-1 px-4 py-2 bg-blue-500 hover:bg-blue-600 text-white font-bold rounded-lg shadow-md transition-transform transform hover:scale-105 active:scale-95";
                    button.addEventListener('click', () => checkAnswer(option));
                    optionsContainer.appendChild(button);
                });
            }
            window.renderMath();
        }

        function checkAnswer(selectedOption = null) {
            const currentQuestion = currentQuizData[currentIndex];
            const messageBox = document.getElementById('messageBox');
            let isCorrect = false;

            if (currentQuizData === equations) {
                const userAnswer = parseFloat(document.getElementById('equationInput').value);
                isCorrect = !isNaN(userAnswer) && userAnswer === currentQuestion.answer;
            } else {
                isCorrect = selectedOption === currentQuestion.answer;
            }

            if (isCorrect) {
                score++;
                messageBox.textContent = "Correct! ✨";
                messageBox.className = 'px-6 py-3 rounded-lg font-semibold text-white bg-green-500';
            } else {
                messageBox.textContent = `Incorrect. The answer is: ${currentQuestion.answer}.`;
                messageBox.className = 'px-6 py-3 rounded-lg font-semibold text-white bg-red-500';
            }
            updateScoreDisplay();
            messageBox.classList.remove('hidden');
            document.getElementById('submitBtn').classList.add('hidden');
            document.getElementById('nextBtn').classList.remove('hidden');
        }

        function loadVideo(url) {
            document.getElementById('videoFrame').src = url;
        }

        async function searchDictionary() {
            const word = document.getElementById('dictionaryInput').value.trim();
            const resultsContainer = document.getElementById('dictionaryResults');
            if (!word) {
                resultsContainer.innerHTML = `<p class="text-red-500">Please enter a word.</p>`;
                return;
            }
            resultsContainer.innerHTML = `<p class="text-gray-500">Searching...</p>`;
            try {
                const response = await fetch(`https://api.dictionaryapi.dev/api/v2/entries/en/${word}`);
                const data = await response.json();
                if (response.status === 404) {
                    resultsContainer.innerHTML = `<p class="text-red-500">Word not found.</p>`;
                    return;
                }
                const definition = data[0].meanings.map(m => `<div class="mb-4"><h3 class="font-bold text-lg">${m.partOfSpeech}</h3><ul class="list-disc list-inside">${m.definitions.map(d => `<li class="text-gray-700">${d.definition}</li>`).join('')}</ul></div>`).join('');
                resultsContainer.innerHTML = `<div class="p-4 bg-gray-100 rounded-lg shadow-inner"><h2 class="text-2xl font-bold mb-2">${word}</h2>${definition}</div>`;
            } catch (error) {
                resultsContainer.innerHTML = `<p class="text-red-500">An error occurred.</p>`;
            }
        }

        function showRandomFunFact() {
            document.getElementById('funFactDisplay').textContent = funFacts[Math.floor(Math.random() * funFacts.length)];
        }

        function setupChatListener() {
            if (!db || !auth.currentUser || unsubscribeChat) return;
            const chatQuery = query(collection(db, `artifacts/${appId}/public/data/chat`), orderBy("timestamp"));
            unsubscribeChat = onSnapshot(chatQuery, (snapshot) => {
                const chatContainer = document.getElementById('chatMessages');
                chatContainer.innerHTML = '';
                snapshot.forEach((doc) => {
                    const msg = doc.data();
                    const el = document.createElement('div');
                    el.className = `p-3 rounded-lg max-w-lg mb-2 shadow-sm ${msg.userId === userId ? 'bg-blue-500 text-white self-end' : 'bg-gray-200 self-start'}`;
                    el.innerHTML = `<div class="text-xs font-semibold mb-1 opacity-75">${msg.userId}</div><div>${msg.text}</div>`;
                    chatContainer.appendChild(el);
                });
                chatContainer.scrollTop = chatContainer.scrollHeight;
            }, (error) => console.error("Error listening to chat:", error));
        }

        async function sendMessage() {
            const input = document.getElementById('chatInput');
            if (!input.value.trim() || !db || !auth.currentUser) return;
            try {
                await addDoc(collection(db, `artifacts/${appId}/public/data/chat`), {
                    userId: auth.currentUser.email || auth.currentUser.uid,
                    text: input.value.trim(),
                    timestamp: serverTimestamp()
                });
                input.value = '';
            } catch (e) {
                console.error("Error sending message:", e);
            }
        }

        function startQuickMath() {
            quickMathScore = 0;
            quickMathTimeLeft = 30;
            document.getElementById('quickMathScore').textContent = `Score: 0`;
            document.getElementById('quickMathTimer').textContent = `Time: 30s`;
            document.getElementById('quickMathResult').classList.add('hidden');
            generateQuickMathQuestion();
            quickMathTimer = setInterval(() => {
                quickMathTimeLeft--;
                document.getElementById('quickMathTimer').textContent = `Time: ${quickMathTimeLeft}s`;
                if (quickMathTimeLeft <= 0) {
                    stopQuickMath();
                    document.getElementById('quickMathResult').textContent = `Time's up! Final score: ${quickMathScore}.`;
                    document.getElementById('quickMathResult').classList.remove('hidden');
                    score += quickMathScore;
                    updateScoreDisplay();
                    saveScoreToFirestore();
                }
            }, 1000);
        }

        function stopQuickMath() {
            clearInterval(quickMathTimer);
        }

        function generateQuickMathQuestion() {
            const num1 = Math.floor(Math.random() * 10) + 1;
            const num2 = Math.floor(Math.random() * 10) + 1;
            const op = ['+', '-', '*'][Math.floor(Math.random() * 3)];
            quickMathCurrentAnswer = eval(`${num1}${op}${num2}`);
            document.getElementById('quickMathQuestion').textContent = `${num1} ${op} ${num2}`;
            document.getElementById('quickMathInput').value = '';
            document.getElementById('quickMathInput').focus();
        }

        function checkQuickMathAnswer() {
            const userAnswer = parseInt(document.getElementById('quickMathInput').value);
            const resultEl = document.getElementById('quickMathResult');
            if (userAnswer === quickMathCurrentAnswer) {
                quickMathScore++;
                document.getElementById('quickMathScore').textContent = `Score: ${quickMathScore}`;
                resultEl.textContent = "Correct! ✅";
                resultEl.className = 'font-bold text-lg text-green-500';
            } else {
                resultEl.textContent = "Incorrect! ❌";
                resultEl.className = 'font-bold text-lg text-red-500';
            }
            generateQuickMathQuestion();
        }

        function resetGuessNumber() {
            guessNumber = Math.floor(Math.random() * 100) + 1;
            guessCount = 0;
            document.getElementById('guessNumberInput').value = '';
            document.getElementById('guessNumberResult').textContent = 'Guess a number between 1 and 100.';
            document.getElementById('guessNumberResult').classList.remove('text-green-500', 'text-red-500');
        }

        function checkGuessNumber() {
            const guess = parseInt(document.getElementById('guessNumberInput').value);
            const resultEl = document.getElementById('guessNumberResult');
            guessCount++;
            if (isNaN(guess) || guess < 1 || guess > 100) {
                resultEl.textContent = 'Please enter a valid number.';
                resultEl.className = 'font-bold text-lg text-red-500';
            } else if (guess < guessNumber) {
                resultEl.textContent = `Too low. Try again! (${guessCount} guesses)`;
                resultEl.className = 'font-bold text-lg text-red-500';
            } else if (guess > guessNumber) {
                resultEl.textContent = `Too high. Try again! (${guessCount} guesses)`;
                resultEl.className = 'font-bold text-lg text-red-500';
            } else {
                resultEl.textContent = `Correct! You got it in ${guessCount} guesses.`;
                resultEl.className = 'font-bold text-lg text-green-500';
                score += Math.max(0, (10 - guessCount) * 10);
                updateScoreDisplay();
                saveScoreToFirestore();
            }
        }
        
        function handleCalculatorClick(event) {
            const { target } = event;
            const { value } = target;
            if (!target.matches('button')) return;

            switch (value) {
                case '+':
                case '-':
                case '*':
                case '/':
                case '=':
                    handleOperator(value);
                    break;
                case '.':
                    inputDecimal(value);
                    break;
                case 'all-clear':
                    resetCalculator();
                    break;
                default:
                    if (Number.isInteger(parseInt(value))) {
                        inputDigit(value);
                    }
            }
            updateCalculatorDisplay();
        }
        
        function updateCalculatorDisplay() {
            document.getElementById('calculator-display').textContent = calculator.displayValue;
        }

        function inputDigit(digit) {
            const { displayValue, waitingForSecondOperand } = calculator;
            if (waitingForSecondOperand) {
                calculator.displayValue = digit;
                calculator.waitingForSecondOperand = false;
            } else {
                calculator.displayValue = displayValue === '0' ? digit : displayValue + digit;
            }
        }

        function inputDecimal(dot) {
            if (calculator.waitingForSecondOperand) return;
            if (!calculator.displayValue.includes(dot)) {
                calculator.displayValue += dot;
            }
        }

        function handleOperator(nextOperator) {
            const { firstOperand, displayValue, operator } = calculator;
            const inputValue = parseFloat(displayValue);

            if (operator && calculator.waitingForSecondOperand) {
                calculator.operator = nextOperator;
                return;
            }

            if (firstOperand == null && !isNaN(inputValue)) {
                calculator.firstOperand = inputValue;
            } else if (operator) {
                const result = performCalculation[operator](firstOperand, inputValue);
                calculator.displayValue = `${parseFloat(result.toFixed(7))}`;
                calculator.firstOperand = result;
            }

            calculator.waitingForSecondOperand = true;
            calculator.operator = nextOperator;
        }

        const performCalculation = {
            '/': (first, second) => first / second,
            '*': (first, second) => first * second,
            '+': (first, second) => first + second,
            '-': (first, second) => first - second,
            '=': (first, second) => second
        };
        
        function resetCalculator() {
            calculator.displayValue = '0';
            calculator.firstOperand = null;
            calculator.waitingForSecondOperand = false;
            calculator.operator = null;
        }

        async function getWeather() {
            const city = document.getElementById('cityInput').value.trim();
            const resultEl = document.getElementById('weatherResult');
            if (!city) {
                resultEl.innerHTML = `<p class="text-red-500">Please enter a city name.</p>`;
                resultEl.classList.remove('hidden');
                return;
            }
            
            // IMPORTANT: You need to get your own API key from OpenWeatherMap for this to work.
            const apiKey = 'd8f8a8f8f8f8f8f8f8f8f8f8f8f8f8f8'; // Replace with a placeholder or explain how to get one
            const apiUrl = `https://api.openweathermap.org/data/2.5/weather?q=${city}&appid=${apiKey}&units=metric`;
            
            resultEl.innerHTML = `<p class="text-gray-500">Fetching weather...</p>`;
            resultEl.classList.remove('hidden');

            try {
                const response = await fetch(apiUrl);
                if (!response.ok) {
                    if (response.status === 401) throw new Error('Invalid API key.');
                    if (response.status === 404) throw new Error('City not found.');
                    throw new Error('Could not fetch weather data.');
                }
                const data = await response.json();
                resultEl.innerHTML = `
                    <h3 class="text-2xl font-bold">${data.name}, ${data.sys.country}</h3>
                    <div class="flex items-center justify-center mt-2">
                        <img src="https://openweathermap.org/img/wn/${data.weather[0].icon}@2x.png" alt="Weather icon" class="w-16 h-16">
                        <div class="text-5xl font-bold ml-4">${Math.round(data.main.temp)}°C</div>
                    </div>
                    <p class="text-lg capitalize mt-2">${data.weather[0].description}</p>
                `;
            } catch (error) {
                resultEl.innerHTML = `<p class="text-red-500">${error.message}</p>`;
            }
        }
    </script>
    <style>
        body { font-family: 'Inter', sans-serif; }
        @keyframes fade-in { 0% { opacity: 0; } 100% { opacity: 1; } }
        .animate-fade-in { animation: fade-in 0.5s ease-in-out; }
    </style>
<style>*, ::before, ::after{--tw-border-spacing-x:0;--tw-border-spacing-y:0;--tw-translate-x:0;--tw-translate-y:0;--tw-rotate:0;--tw-skew-x:0;--tw-skew-y:0;--tw-scale-x:1;--tw-scale-y:1;--tw-pan-x: ;--tw-pan-y: ;--tw-pinch-zoom: ;--tw-scroll-snap-strictness:proximity;--tw-gradient-from-position: ;--tw-gradient-via-position: ;--tw-gradient-to-position: ;--tw-ordinal: ;--tw-slashed-zero: ;--tw-numeric-figure: ;--tw-numeric-spacing: ;--tw-numeric-fraction: ;--tw-ring-inset: ;--tw-ring-offset-width:0px;--tw-ring-offset-color:#fff;--tw-ring-color:rgb(59 130 246 / 0.5);--tw-ring-offset-shadow:0 0 #0000;--tw-ring-shadow:0 0 #0000;--tw-shadow:0 0 #0000;--tw-shadow-colored:0 0 #0000;--tw-blur: ;--tw-brightness: ;--tw-contrast: ;--tw-grayscale: ;--tw-hue-rotate: ;--tw-invert: ;--tw-saturate: ;--tw-sepia: ;--tw-drop-shadow: ;--tw-backdrop-blur: ;--tw-backdrop-brightness: ;--tw-backdrop-contrast: ;--tw-backdrop-grayscale: ;--tw-backdrop-hue-rotate: ;--tw-backdrop-invert: ;--tw-backdrop-opacity: ;--tw-backdrop-saturate: ;--tw-backdrop-sepia: ;--tw-contain-size: ;--tw-contain-layout: ;--tw-contain-paint: ;--tw-contain-style: }::backdrop{--tw-border-spacing-x:0;--tw-border-spacing-y:0;--tw-translate-x:0;--tw-translate-y:0;--tw-rotate:0;--tw-skew-x:0;--tw-skew-y:0;--tw-scale-x:1;--tw-scale-y:1;--tw-pan-x: ;--tw-pan-y: ;--tw-pinch-zoom: ;--tw-scroll-snap-strictness:proximity;--tw-gradient-from-position: ;--tw-gradient-via-position: ;--tw-gradient-to-position: ;--tw-ordinal: ;--tw-slashed-zero: ;--tw-numeric-figure: ;--tw-numeric-spacing: ;--tw-numeric-fraction: ;--tw-ring-inset: ;--tw-ring-offset-width:0px;--tw-ring-offset-color:#fff;--tw-ring-color:rgb(59 130 246 / 0.5);--tw-ring-offset-shadow:0 0 #0000;--tw-ring-shadow:0 0 #0000;--tw-shadow:0 0 #0000;--tw-shadow-colored:0 0 #0000;--tw-blur: ;--tw-brightness: ;--tw-contrast: ;--tw-grayscale: ;--tw-hue-rotate: ;--tw-invert: ;--tw-saturate: ;--tw-sepia: ;--tw-drop-shadow: ;--tw-backdrop-blur: ;--tw-backdrop-brightness: ;--tw-backdrop-contrast: ;--tw-backdrop-grayscale: ;--tw-backdrop-hue-rotate: ;--tw-backdrop-invert: ;--tw-backdrop-opacity: ;--tw-backdrop-saturate: ;--tw-backdrop-sepia: ;--tw-contain-size: ;--tw-contain-layout: ;--tw-contain-paint: ;--tw-contain-style: }/* ! tailwindcss v3.4.17 | MIT License | https://tailwindcss.com */*,::after,::before{box-sizing:border-box;border-width:0;border-style:solid;border-color:#e5e7eb}::after,::before{--tw-content:''}:host,html{line-height:1.5;-webkit-text-size-adjust:100%;-moz-tab-size:4;tab-size:4;font-family:ui-sans-serif, system-ui, sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol", "Noto Color Emoji";font-feature-settings:normal;font-variation-settings:normal;-webkit-tap-highlight-color:transparent}body{margin:0;line-height:inherit}hr{height:0;color:inherit;border-top-width:1px}abbr:where([title]){-webkit-text-decoration:underline dotted;text-decoration:underline dotted}h1,h2,h3,h4,h5,h6{font-size:inherit;font-weight:inherit}a{color:inherit;text-decoration:inherit}b,strong{font-weight:bolder}code,kbd,pre,samp{font-family:ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;font-feature-settings:normal;font-variation-settings:normal;font-size:1em}small{font-size:80%}sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}sub{bottom:-.25em}sup{top:-.5em}table{text-indent:0;border-color:inherit;border-collapse:collapse}button,input,optgroup,select,textarea{font-family:inherit;font-feature-settings:inherit;font-variation-settings:inherit;font-size:100%;font-weight:inherit;line-height:inherit;letter-spacing:inherit;color:inherit;margin:0;padding:0}button,select{text-transform:none}button,input:where([type=button]),input:where([type=reset]),input:where([type=submit]){-webkit-appearance:button;background-color:transparent;background-image:none}:-moz-focusring{outline:auto}:-moz-ui-invalid{box-shadow:none}progress{vertical-align:baseline}::-webkit-inner-spin-button,::-webkit-outer-spin-button{height:auto}[type=search]{-webkit-appearance:textfield;outline-offset:-2px}::-webkit-search-decoration{-webkit-appearance:none}::-webkit-file-upload-button{-webkit-appearance:button;font:inherit}summary{display:list-item}blockquote,dd,dl,figure,h1,h2,h3,h4,h5,h6,hr,p,pre{margin:0}fieldset{margin:0;padding:0}legend{padding:0}menu,ol,ul{list-style:none;margin:0;padding:0}dialog{padding:0}textarea{resize:vertical}input::placeholder,textarea::placeholder{opacity:1;color:#9ca3af}[role=button],button{cursor:pointer}:disabled{cursor:default}audio,canvas,embed,iframe,img,object,svg,video{display:block;vertical-align:middle}img,video{max-width:100%;height:auto}[hidden]:where(:not([hidden=until-found])){display:none}.mx-auto{margin-left:auto;margin-right:auto}.flex{display:flex}.grid{display:grid}.hidden{display:none}.min-h-screen{min-height:100vh}.w-full{width:100%}.max-w-2xl{max-width:42rem}.max-w-md{max-width:28rem}.flex-1{flex:1 1 0%}.transform{transform:translate(var(--tw-translate-x), var(--tw-translate-y)) rotate(var(--tw-rotate)) skewX(var(--tw-skew-x)) skewY(var(--tw-skew-y)) scaleX(var(--tw-scale-x)) scaleY(var(--tw-scale-y))}.grid-cols-2{grid-template-columns:repeat(2, minmax(0, 1fr))}.flex-col{flex-direction:column}.items-center{align-items:center}.justify-center{justify-content:center}.justify-between{justify-content:space-between}.gap-4{gap:1rem}.space-y-2 > :not([hidden]) ~ :not([hidden]){--tw-space-y-reverse:0;margin-top:calc(0.5rem * calc(1 - var(--tw-space-y-reverse)));margin-bottom:calc(0.5rem * var(--tw-space-y-reverse))}.space-y-4 > :not([hidden]) ~ :not([hidden]){--tw-space-y-reverse:0;margin-top:calc(1rem * calc(1 - var(--tw-space-y-reverse)));margin-bottom:calc(1rem * var(--tw-space-y-reverse))}.space-y-6 > :not([hidden]) ~ :not([hidden]){--tw-space-y-reverse:0;margin-top:calc(1.5rem * calc(1 - var(--tw-space-y-reverse)));margin-bottom:calc(1.5rem * var(--tw-space-y-reverse))}.space-y-8 > :not([hidden]) ~ :not([hidden]){--tw-space-y-reverse:0;margin-top:calc(2rem * calc(1 - var(--tw-space-y-reverse)));margin-bottom:calc(2rem * var(--tw-space-y-reverse))}.break-all{word-break:break-all}.rounded-2xl{border-radius:1rem}.rounded-lg{border-radius:0.5rem}.rounded-xl{border-radius:0.75rem}.bg-gray-100{--tw-bg-opacity:1;background-color:rgb(243 244 246 / var(--tw-bg-opacity, 1))}.bg-gray-500{--tw-bg-opacity:1;background-color:rgb(107 114 128 / var(--tw-bg-opacity, 1))}.bg-indigo-500{--tw-bg-opacity:1;background-color:rgb(99 102 241 / var(--tw-bg-opacity, 1))}.bg-purple-500{--tw-bg-opacity:1;background-color:rgb(168 85 247 / var(--tw-bg-opacity, 1))}.bg-red-500{--tw-bg-opacity:1;background-color:rgb(239 68 68 / var(--tw-bg-opacity, 1))}.bg-white{--tw-bg-opacity:1;background-color:rgb(255 255 255 / var(--tw-bg-opacity, 1))}.bg-gradient-to-r{background-image:linear-gradient(to right, var(--tw-gradient-stops))}.from-blue-500{--tw-gradient-from:#3b82f6 var(--tw-gradient-from-position);--tw-gradient-to:rgb(59 130 246 / 0) var(--tw-gradient-to-position);--tw-gradient-stops:var(--tw-gradient-from), var(--tw-gradient-to)}.from-fuchsia-500{--tw-gradient-from:#d946ef var(--tw-gradient-from-position);--tw-gradient-to:rgb(217 70 239 / 0) var(--tw-gradient-to-position);--tw-gradient-stops:var(--tw-gradient-from), var(--tw-gradient-to)}.from-gray-700{--tw-gradient-from:#374151 var(--tw-gradient-from-position);--tw-gradient-to:rgb(55 65 81 / 0) var(--tw-gradient-to-position);--tw-gradient-stops:var(--tw-gradient-from), var(--tw-gradient-to)}.from-green-500{--tw-gradient-from:#22c55e var(--tw-gradient-from-position);--tw-gradient-to:rgb(34 197 94 / 0) var(--tw-gradient-to-position);--tw-gradient-stops:var(--tw-gradient-from), var(--tw-gradient-to)}.from-orange-400{--tw-gradient-from:#fb923c var(--tw-gradient-from-position);--tw-gradient-to:rgb(251 146 60 / 0) var(--tw-gradient-to-position);--tw-gradient-stops:var(--tw-gradient-from), var(--tw-gradient-to)}.from-purple-500{--tw-gradient-from:#a855f7 var(--tw-gradient-from-position);--tw-gradient-to:rgb(168 85 247 / 0) var(--tw-gradient-to-position);--tw-gradient-stops:var(--tw-gradient-from), var(--tw-gradient-to)}.from-rose-500{--tw-gradient-from:#f43f5e var(--tw-gradient-from-position);--tw-gradient-to:rgb(244 63 94 / 0) var(--tw-gradient-to-position);--tw-gradient-stops:var(--tw-gradient-from), var(--tw-gradient-to)}.from-sky-400{--tw-gradient-from:#38bdf8 var(--tw-gradient-from-position);--tw-gradient-to:rgb(56 189 248 / 0) var(--tw-gradient-to-position);--tw-gradient-stops:var(--tw-gradient-from), var(--tw-gradient-to)}.from-slate-500{--tw-gradient-from:#64748b var(--tw-gradient-from-position);--tw-gradient-to:rgb(100 116 139 / 0) var(--tw-gradient-to-position);--tw-gradient-stops:var(--tw-gradient-from), var(--tw-gradient-to)}.from-teal-500{--tw-gradient-from:#14b8a6 var(--tw-gradient-from-position);--tw-gradient-to:rgb(20 184 166 / 0) var(--tw-gradient-to-position);--tw-gradient-stops:var(--tw-gradient-from), var(--tw-gradient-to)}.from-yellow-400{--tw-gradient-from:#facc15 var(--tw-gradient-from-position);--tw-gradient-to:rgb(250 204 21 / 0) var(--tw-gradient-to-position);--tw-gradient-stops:var(--tw-gradient-from), var(--tw-gradient-to)}.to-amber-500{--tw-gradient-to:#f59e0b var(--tw-gradient-to-position)}.to-blue-500{--tw-gradient-to:#3b82f6 var(--tw-gradient-to-position)}.to-cyan-600{--tw-gradient-to:#0891b2 var(--tw-gradient-to-position)}.to-gray-800{--tw-gradient-to:#1f2937 var(--tw-gradient-to-position)}.to-indigo-600{--tw-gradient-to:#4f46e5 var(--tw-gradient-to-position)}.to-lime-600{--tw-gradient-to:#65a30d var(--tw-gradient-to-position)}.to-pink-600{--tw-gradient-to:#db2777 var(--tw-gradient-to-position)}.to-red-500{--tw-gradient-to:#ef4444 var(--tw-gradient-to-position)}.to-red-600{--tw-gradient-to:#dc2626 var(--tw-gradient-to-position)}.to-sky-600{--tw-gradient-to:#0284c7 var(--tw-gradient-to-position)}.to-slate-700{--tw-gradient-to:#334155 var(--tw-gradient-to-position)}.p-4{padding:1rem}.p-8{padding:2rem}.px-6{padding-left:1.5rem;padding-right:1.5rem}.py-3{padding-top:0.75rem;padding-bottom:0.75rem}.py-4{padding-top:1rem;padding-bottom:1rem}.text-center{text-align:center}.text-3xl{font-size:1.875rem;line-height:2.25rem}.text-4xl{font-size:2.25rem;line-height:2.5rem}.text-sm{font-size:0.875rem;line-height:1.25rem}.text-xs{font-size:0.75rem;line-height:1rem}.font-bold{font-weight:700}.font-extrabold{font-weight:800}.font-medium{font-weight:500}.font-semibold{font-weight:600}.leading-relaxed{line-height:1.625}.text-gray-400{--tw-text-opacity:1;color:rgb(156 163 175 / var(--tw-text-opacity, 1))}.text-gray-500{--tw-text-opacity:1;color:rgb(107 114 128 / var(--tw-text-opacity, 1))}.text-gray-600{--tw-text-opacity:1;color:rgb(75 85 99 / var(--tw-text-opacity, 1))}.text-gray-800{--tw-text-opacity:1;color:rgb(31 41 55 / var(--tw-text-opacity, 1))}.text-white{--tw-text-opacity:1;color:rgb(255 255 255 / var(--tw-text-opacity, 1))}.shadow-md{--tw-shadow:0 4px 6px -1px rgb(0 0 0 / 0.1), 0 2px 4px -2px rgb(0 0 0 / 0.1);--tw-shadow-colored:0 4px 6px -1px var(--tw-shadow-color), 0 2px 4px -2px var(--tw-shadow-color);box-shadow:var(--tw-ring-offset-shadow, 0 0 #0000), var(--tw-ring-shadow, 0 0 #0000), var(--tw-shadow)}.shadow-xl{--tw-shadow:0 20px 25px -5px rgb(0 0 0 / 0.1), 0 8px 10px -6px rgb(0 0 0 / 0.1);--tw-shadow-colored:0 20px 25px -5px var(--tw-shadow-color), 0 8px 10px -6px var(--tw-shadow-color);box-shadow:var(--tw-ring-offset-shadow, 0 0 #0000), var(--tw-ring-shadow, 0 0 #0000), var(--tw-shadow)}.transition-transform{transition-property:transform;transition-timing-function:cubic-bezier(0.4, 0, 0.2, 1);transition-duration:150ms}.hover\:scale-105:hover{--tw-scale-x:1.05;--tw-scale-y:1.05;transform:translate(var(--tw-translate-x), var(--tw-translate-y)) rotate(var(--tw-rotate)) skewX(var(--tw-skew-x)) skewY(var(--tw-skew-y)) scaleX(var(--tw-scale-x)) scaleY(var(--tw-scale-y))}.hover\:bg-gray-600:hover{--tw-bg-opacity:1;background-color:rgb(75 85 99 / var(--tw-bg-opacity, 1))}.hover\:bg-indigo-600:hover{--tw-bg-opacity:1;background-color:rgb(79 70 229 / var(--tw-bg-opacity, 1))}.hover\:bg-purple-600:hover{--tw-bg-opacity:1;background-color:rgb(147 51 234 / var(--tw-bg-opacity, 1))}.hover\:bg-red-600:hover{--tw-bg-opacity:1;background-color:rgb(220 38 38 / var(--tw-bg-opacity, 1))}@media (min-width: 640px){.sm\:flex-row{flex-direction:row}.sm\:space-x-4 > :not([hidden]) ~ :not([hidden]){--tw-space-x-reverse:0;margin-right:calc(1rem * var(--tw-space-x-reverse));margin-left:calc(1rem * calc(1 - var(--tw-space-x-reverse)))}.sm\:space-y-0 > :not([hidden]) ~ :not([hidden]){--tw-space-y-reverse:0;margin-top:calc(0px * calc(1 - var(--tw-space-y-reverse)));margin-bottom:calc(0px * var(--tw-space-y-reverse))}}@media (min-width: 1024px){.lg\:grid-cols-3{grid-template-columns:repeat(3, minmax(0, 1fr))}}</style></head>
<body class="bg-gray-100 min-h-screen flex items-center justify-center p-4">

    <!-- Main Container -->
    <div class="bg-white rounded-2xl shadow-xl w-full max-w-2xl p-8 flex flex-col items-center space-y-8">

        <!-- Header -->
        <header class="text-center space-y-2">
            <h1 class="text-4xl font-extrabold text-gray-800">The Learning App</h1>
            <p class="text-gray-500 font-medium">Your personal learning and utility companion.</p>
        </header>

        <div class="flex justify-between w-full text-sm text-gray-400">
            <div id="userIdDisplay" class="text-xs break-all">User: 09691283029940985061</div>
            <div id="scoreDisplay" class="font-semibold text-gray-600">Score: 0</div>
        </div>
        
        <!-- Home View -->
        <div id="home-view" class="app-view w-full space-y-6 text-center">
            <p class="text-gray-600 leading-relaxed max-w-md mx-auto">
                Select a feature below to begin your learning journey.
            </p>
            <div id="auth-buttons" class="flex flex-col sm:flex-row space-y-4 sm:space-y-0 sm:space-x-4 hidden">
                <button id="signup-btn" class="flex-1 px-6 py-3 bg-purple-500 hover:bg-purple-600 text-white font-bold rounded-lg shadow-md transition-transform transform hover:scale-105">Sign Up</button>
                <button id="signin-btn" class="flex-1 px-6 py-3 bg-indigo-500 hover:bg-indigo-600 text-white font-bold rounded-lg shadow-md transition-transform transform hover:scale-105">Sign In</button>
            </div>
            <button id="signout-btn" class="px-6 py-3 bg-red-500 hover:bg-red-600 text-white font-bold rounded-lg shadow-md transition-transform transform hover:scale-105">Sign Out</button>

            <div class="grid grid-cols-2 lg:grid-cols-3 gap-4 w-full">
                <button id="equations-btn" class="px-6 py-4 bg-gradient-to-r from-teal-500 to-cyan-600 text-white font-bold rounded-xl shadow-md transition-transform transform hover:scale-105">Equations Quiz</button>
                <button id="language-btn" class="px-6 py-4 bg-gradient-to-r from-fuchsia-500 to-pink-600 text-white font-bold rounded-xl shadow-md transition-transform transform hover:scale-105">Language Quiz</button>
                <button id="iq-btn" class="px-6 py-4 bg-gradient-to-r from-slate-500 to-slate-700 text-white font-bold rounded-xl shadow-md transition-transform transform hover:scale-105">IQ Challenge</button>
                <button id="test-quiz-btn" class="px-6 py-4 bg-gradient-to-r from-orange-400 to-red-500 text-white font-bold rounded-xl shadow-md transition-transform transform hover:scale-105">Test Quiz</button>
                <button id="videos-btn" class="px-6 py-4 bg-gradient-to-r from-purple-500 to-indigo-600 text-white font-bold rounded-xl shadow-md transition-transform transform hover:scale-105">Videos</button>
                <button id="chat-btn" class="px-6 py-4 bg-gradient-to-r from-green-500 to-lime-600 text-white font-bold rounded-xl shadow-md transition-transform transform hover:scale-105">Chat</button>
                <button id="dictionary-btn" class="px-6 py-4 bg-gradient-to-r from-blue-500 to-sky-600 text-white font-bold rounded-xl shadow-md transition-transform transform hover:scale-105">Dictionary</button>
                <button id="fun-facts-btn" class="px-6 py-4 bg-gradient-to-r from-yellow-400 to-amber-500 text-white font-bold rounded-xl shadow-md transition-transform transform hover:scale-105">Fun Facts</button>
                <button id="games-btn" class="px-6 py-4 bg-gradient-to-r from-rose-500 to-red-600 text-white font-bold rounded-xl shadow-md transition-transform transform hover:scale-105">Games</button>
                <button id="calculator-btn" class="px-6 py-4 bg-gradient-to-r from-gray-700 to-gray-800 text-white font-bold rounded-xl shadow-md transition-transform transform hover:scale-105">Calculator</button>
                <button id="weather-btn" class="px-6 py-4 bg-gradient-to-r from-sky-400 to-blue-500 text-white font-bold rounded-xl shadow-md transition-transform transform hover:scale-105">Weather</button>
            </div>
            <div class="flex flex-col sm:flex-row space-y-4 sm:space-y-0 sm:space-x-4">
                <button id="leaderboard-btn" class="flex-1 px-6 py-3 bg-gray-500 hover:bg-gray-600 text-white font-bold rounded-lg shadow-md transition-transform transform hover:scale-105">Leaderboard</button>
                <button id="search-btn" class="flex-1 px-6 py-3 bg-gray-500 hover:bg-gray-600 text-white font-bold rounded-lg shadow-md transition-transform transform hover:scale-105">Search</button>
                <button id="history-btn" class="flex-1 px-6 py-3 bg-gray-500 hover:bg-gray-600 text-white font-bold rounded-lg shadow-md transition-transform transform hover:scale-105">History</button>
                <button id="ai-assistant-btn" class="flex-1 px-6 py-3 bg-gray-500 hover:bg-gray-600 text-white font-bold rounded-lg shadow-md transition-transform transform hover:scale-105">AI Assistant</button>
            </div>
        </div>
        
        <!-- All other views follow... (Games, Calculator, Weather, Quizzes etc.) -->
        <div id="games-view" class="app-view hidden w-full space-y-6 text-center">
             <h2 class="text-3xl font-bold text-gray-800">
</h2></div></div></body></html>